<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: auth.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: auth.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * JSON Web Token (JWT) secret key used for signing and verifying tokens.
 * @constant {string}
 * @default
 */
const jwtSecret = 'your_jwt_secret'; 
const jwt = require('jsonwebtoken');
const passport = require('passport');
require('./passport'); 

/**
 * Function to generate a JWT token for the provided user.
 * @param {object} user - The user object to be encoded in the JWT.
 * @returns {string} JWT token generated for the user.
 */
let generateJWTToken = (user) => {
  return jwt.sign(user, jwtSecret, {
    subject: user.Username, 
    expiresIn: '7d', 
    algorithm: 'HS256'
  });
}

 /**
   * Route for user login.
   * @name POSTLoginRoute
   * @function
   * @param {object} req - The request object containing user credentials.
   * @param {object} res - The response object containing authentication details.
   */
module.exports = (router) => {
  router.post('/login', (req, res) => {
    passport.authenticate('local', { session: false }, (error, user, info) => {
      if (error || !user) {
        return res.status(400).json({
          message: 'Incorrect credentials provided. Try again or create a new user using the /users endpoint.',
          user: user
        });
      }
      req.login(user, { session: false }, (error) => {
        if (error) {
          res.send(error);
        }
        const token = generateJWTToken(user.toJSON());

        const responseUser = { username: user.Username, email: user.Email, birthday: user.Birthday.toDateString, _id: user._id,};

        return res.json({ user: responseUser, message: 'Token generated. Use this JWT for authentication in future requests.', token });
      });
    })(req, res);
  });
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-PassportAuth.html">PassportAuth</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AddMovieToFavoritesRoute">AddMovieToFavoritesRoute</a></li><li><a href="global.html#AddUserRoute">AddUserRoute</a></li><li><a href="global.html#DeleteUserAccountRoute">DeleteUserAccountRoute</a></li><li><a href="global.html#GetAllMoviesRoute">GetAllMoviesRoute</a></li><li><a href="global.html#GetDirectorByNameRoute">GetDirectorByNameRoute</a></li><li><a href="global.html#GetGenreByNameRoute">GetGenreByNameRoute</a></li><li><a href="global.html#GetMovieByTitleRoute">GetMovieByTitleRoute</a></li><li><a href="global.html#GetUserByUsernameRoute">GetUserByUsernameRoute</a></li><li><a href="global.html#GetUserFavoritesRoute">GetUserFavoritesRoute</a></li><li><a href="global.html#GetUsersRoute">GetUsersRoute</a></li><li><a href="global.html#Movie">Movie</a></li><li><a href="global.html#POSTLoginRoute">POSTLoginRoute</a></li><li><a href="global.html#RemoveMovieFromFavoritesRoute">RemoveMovieFromFavoritesRoute</a></li><li><a href="global.html#UpdateUserInfoRoute">UpdateUserInfoRoute</a></li><li><a href="global.html#User">User</a></li><li><a href="global.html#WelcomeRoute">WelcomeRoute</a></li><li><a href="global.html#app">app</a></li><li><a href="global.html#cors">cors</a></li><li><a href="global.html#generateJWTToken">generateJWTToken</a></li><li><a href="global.html#jwtSecret">jwtSecret</a></li><li><a href="global.html#movieSchema">movieSchema</a></li><li><a href="global.html#passport">passport</a></li><li><a href="global.html#userSchema">userSchema</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Mon May 13 2024 16:12:53 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
